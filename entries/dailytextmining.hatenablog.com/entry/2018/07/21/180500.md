---
Title: 2018/7/20【28日目】ランダムフォレストにtweetの内容を渡してみたけどダメだった
Category:
- 180日間テキストマイニング
Date: 2018-07-21T18:05:00+09:00
URL: https://dailytextmining.hatenablog.com/entry/2018/07/21/180500
EditURL: https://blog.hatena.ne.jp/rimt/dailytextmining.hatenablog.com/atom/entry/10257846132603262349
---

昨日の段階で正解データは作成しましたので、今日は学習データを作っていきたいと思います。


取りあえず読込み。
```
tweets = pd.read_csv('tweet_20180720.csv',
                    sep=r"\s+",
                    encoding='utf-8',
                    error_bad_lines=False)
```

sepで指定した<b>r"\s+”</b>というのは正規表現で1個以上の空白文字という意味ですが、なんで空白文字を指定するとTweet毎に分けられるのかよくわらないです。Tweet毎に分ける方法を調べていたら海外勢がみんな”delimiter=r"\s+””と指定していましたので、真似してみました。
ちなみにdelimiterはデリミタと呼ぶらしいです、意味は区切り文字です。


あと、ちょこちょこエラーが出ますので、error_bad_lines=Falseというエラーを読み飛ばす、という謎に便利な引数がありましたので、ひとまず今回はそれを付け加えています。


読み込めたところでデータの確認。
```python
print(names.shape)
print(tweets.shape)
```
実行結果。
```
(1566, 1)
(1567, 1)
```

なぜか行数がずれていますね。

csvファイルの中身を見てみましたら。1567行が正しいみたいですので、nameの何かが読み取れていないようです。csvで中身をみてましたら、どうやら最後の行が読み取れていないようです。区切り文字を改行にしているので、最後の行が改行されていないとかでしょうか？


解決法が見当たらなかったので、最後の行をコピペで追加して無理やり行数を合わせました。
```
print(names.shape)
print(tweets.shape)
```
実行結果。
```
(1567, 1)
(1567, 1)
```

行数があったので、取りあえずランダムフォレストを実行させてみます。
```
from sklearn.ensemble import RandomForestClassifier
X = tweets
y = names
clf = RandomForestClassifier(max_depth=2, random_state=0)
clf.fit(X, y)
```
実行結果。
```
ValueError: could not convert string to float: '深夜1:55〜です(#^.^#)/?\n\n#京都 #いろどり日記 #カンテレ https://t.co/BptnjjTcwO'
```

まぁ、当然ですが、エラーが起こりますね。stringはfloatに変換できないとのこと。そもそもstringをfitメソッドに渡すことができなさそうなので、文字列を数値化させる必要があるみたいです。


さぁ、どうしよう、、、取りあえずランダムフォレストに情報を渡せるデータを作っていかないといけないですね。

ひとまず実験的にlen関数を使って、tweetの文字数を追加したいと思います。

```python
nagasa_atai = []
for content in tweets[“tweet"]:
    lenght = len(content)
    nagasa_atai.append(lenght)
    
tweets['nagasa'] = np.array(nagasa_atai)
```
tweetsシリーズのtweet列をfor文で回して、nagasa_atai配列に追加して、最終的にnagasa列に追加しています。

うまくできたか確認してみます。

```python
tweets.head()
```
実行結果。

```
tweet	nagasa	
0	#アイドル修業中♡公演\n来てくれて、見てくれて、\nありがとうございました???！\n\n...	140
1	今日は #山根涼羽 ずんちゃんと、\nカフェに行ったりお買い物しました☕??\n大切な同期と...	106
2	投票した\nマイスイートピアノちゃん\n17位だ???！！！！！\nピアノちゃんすき?！！！...	69
3	今日から7月です?☀️?\n7月も皆さんどうぞよろしくお願いします☺︎\n\n오늘부터 7월...	109
4	梅雨明けだーーー?！！！！！\n暑い実に暑い、、??\n暑さにみなさんが負けませんように.....	83
```

seriesに新しい列を追加できました。
なかなか良さそうですね。この調子で新しい列をどんどん追加していきます。

というわけで、今日はここまでにして明日はどんどんデータを作っていきます。

##今日の結果
今日のAKBメンバーによる呟きは53件でした。

[f:id:rimt:20180721180250p:plain]
```
'可愛い': 8, '嬉しい': 6, '暑い': 5, '楽しい': 3, '美味しい': 2, '凄い': 2, 'かっこよい': 2, 'すっごい': 2, 'かわいい': 2, '無い': 1, 'おしい': 1, '良い': 1, '面白い': 1, 'いい': 1, 'よろしい': 1, 'すごい': 1, '怖い': 1, 'よい': 1, 'うれしい': 1})

'さん': 17, '私': 10, '時': 9, '可愛い': 8, '今日': 8, '日': 8, 'ちゃん': 8, '嬉しい': 6, '舞台': 6, '人': 6, '暑い': 5, '観': 5, 'お願い': 5, '笑い': 5, '配信': 5, 'こと': 5, 

'する': 39, 'さん': 17, 'ある': 15, 'くださる': 13, '私': 10, 'くる': 10, '時': 9, '見る': 9, '可愛い': 8, '今日': 8, '日': 8, 'ちゃん': 8, 'てる': 7, '来る': 7, '行く': 7, '嬉しい': 6, '舞台': 6, '人': 6, 'なる': 6, '暑い': 5, '観': 5, 'お願い': 5, '笑い': 5, '配信': 5, 'こと': 5, 'せる': 5, 'れる': 5,
```
